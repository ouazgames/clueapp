<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon-120x120.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon-152x152.png" />
  <link rel="apple-touch-icon" sizes="167x167" href="/images/favicon-167x167.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-180x180.png" />

  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="48x48" href="/images/favicon-48x48.png" />
  <link rel="icon" type="image/png" sizes="64x64" href="/images/favicon-64x64.png" />
  <link rel="shortcut icon" href="/images/favicon.ico" />
  <link rel="stylesheet" href="common.css" />

  <meta property="og:title" content="Clues by Sam" />
  <meta property="og:image" content="https://cluesbysam.com/images/74029611514d.jpg" />
  <meta property="og:description" content="A logic puzzle where you deduce who is a criminal!" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="https://cluesbysam.com/images/74029611514d.jpg" />
  <meta name="color-scheme" content="light only" />
  <meta name="supported-color-schemes" content="light" />
  <meta name="robots" content="max-image-preview:large" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Ribeye&display=swap" rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Comic+Neue:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap"
    rel="stylesheet" />
  <title>Clues By Sam</title>
  <style>
    :root {
      --safe-area-inset-top: env(safe-area-inset-top);
      --safe-area-inset-bottom: env(safe-area-inset-bottom);
      --safe-area-inset-left: env(safe-area-inset-left);
      --safe-area-inset-right: env(safe-area-inset-right);
    }
    body {
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
      padding-left: env(safe-area-inset-left);
      padding-right: env(safe-area-inset-right);
    }
  </style>
  <script>
    // ==========================================
    // LEVEL PROGRESSION SYSTEM
    // Total levels played tracking - continues past 50
    // ==========================================
    const TOTAL_PUZZLES = 50;

    // Get the total level number (1, 2, 3... 50, 51, 52...)
    function getTotalLevel() {
      return parseInt(localStorage.getItem('cluesbysam_total_level') || '1');
    }

    function setTotalLevel(level) {
      localStorage.setItem('cluesbysam_total_level', level.toString());
    }

    // Get which puzzle to load (1-50, cycling)
    function getPuzzleNumber(totalLevel) {
      return ((totalLevel - 1) % TOTAL_PUZZLES) + 1;
    }

    // Obfuscated puzzle hash map - only you know these!
    const PUZZLE_HASHES = {
      1: "8aa15091a232", 2: "bad1fcbd0ec5", 3: "684233c01fca", 4: "23c43dbe2a37", 5: "9c53c1ae5344",
      6: "78e820375276", 7: "de6c2fb44bd1", 8: "b6b573e8de8e", 9: "da0bb9fb2cd9", 10: "6baae50faf8a",
      11: "6cbf6d256778", 12: "b7b982ec1191", 13: "656f4ab5e464", 14: "f3042cb0f5ec", 15: "6c1a70232b95",
      16: "d6235521a569", 17: "21493e6b6140", 18: "703916bb416d", 19: "5a5aa0bd997c", 20: "98c74c6d6e44",
      21: "51f3ecf10a81", 22: "e8dde6ff8dc1", 23: "6efda75291c8", 24: "63b339a39097", 25: "175ca6478890",
      26: "262ff76dcd13", 27: "ed23e2304ae8", 28: "bb3664b02089", 29: "2f42fbfcdaf9", 30: "c629d699bf3c",
      31: "521c0eb12288", 32: "83f5e2a2c9d3", 33: "92471ae08a9c", 34: "11cb6872e594", 35: "48ce3cb8cfbd",
      36: "c72891018b1b", 37: "4d49ca3e2134", 38: "5ea3be3177d5", 39: "b3eef6f8d2bb", 40: "6e2c04ee211d",
      41: "6310edfd1b2b", 42: "d9e838da8fb9", 43: "ab644e25dde8", 44: "d645485f7161", 45: "5e9419f2e0fa",
      46: "5096b4d921c5", 47: "dae6db907d2b", 48: "43537ae10d78", 49: "5220a658f51b", 50: "165362d90111"
    };

    function loadLevel(totalLevel) {
      const puzzleNum = getPuzzleNumber(totalLevel);
      const hash = PUZZLE_HASHES[puzzleNum];
      const scriptPath = `./game/assets/${hash}.js`;
      console.log(`Loading Level ${totalLevel}: ${scriptPath}`);

      const script = document.createElement('script');
      script.type = 'module';
      script.crossOrigin = 'anonymous';
      script.src = scriptPath;
      document.head.appendChild(script);
    }

    // ==========================================
    // THEME SYSTEM
    // ==========================================
    function callShare() {
      window.share(true);
    }

    const THEMES = ["theme-default", "theme-acc-1"];

    function convert(savedTheme) {
      if (savedTheme == "theme-default") return { theme: 0, dark: true };
      if (savedTheme == "theme-acc-1") return { theme: 1, dark: true };
      else return { theme: 0, dark: true };
    }

    document.addEventListener("DOMContentLoaded", () => {
      console.log("Load");
      const themePreference = convert(localStorage.getItem("theme"));
      document.body.className = `${THEMES[themePreference.theme]} ${themePreference.dark ? "light" : "light"}`;

      // Update level display
      const totalLevel = getTotalLevel();
      const levelDisplay = document.getElementById('level-display');
      if (levelDisplay) {
        levelDisplay.innerHTML = `<b>Level ${totalLevel}</b>`;
      }

      // Replace "Puzzle #X" text in the game with actual level number
      replacePuzzleText(totalLevel);
    });

    // Replace "Puzzle #X" text in the game
    function replacePuzzleText(totalLevel) {
      setInterval(() => {
        // Find all text nodes and elements containing "Puzzle #"
        const walker = document.createTreeWalker(
          document.body,
          NodeFilter.SHOW_TEXT,
          null,
          false
        );

        let node;
        while (node = walker.nextNode()) {
          if (node.nodeValue && node.nodeValue.match(/Puzzle #\d+/)) {
            node.nodeValue = node.nodeValue.replace(/Puzzle #\d+/, `Level ${totalLevel}`);
          }
        }
      }, 500);
    }

    // ==========================================
    // LEVEL NAVIGATION
    // ==========================================
    function goToNextLevel() {
      const current = getTotalLevel();
      setTotalLevel(current + 1);
      location.reload();
    }

    function goToPrevLevel() {
      const current = getTotalLevel();
      if (current > 1) {
        setTotalLevel(current - 1);
        location.reload();
      }
    }

    // Load the current level's script
    loadLevel(getTotalLevel());
  </script>
  <link rel="stylesheet" crossorigin href="./assets/index.css">
</head>

<body class="theme-default">
  <div id="fontPreload" style="position: absolute; top: -9999px; font-family: 'Ribeye'">Loading...</div>
  <div id="fontPreload" style="position: absolute; top: -9999px; font-family: 'Comic Neue'">Loading...</div>

  <!-- LEVEL DISPLAY -->
  <div id="level-display" style="text-align: center; font-size: 24px; margin: 10px 0; padding: 10px;"><b>Level 1</b>
  </div>

  <!-- GAME CONTAINER -->
  <div id="root"></div>

  <!-- NAVIGATION BUTTONS -->
  <div style="text-align: center; margin: 20px 0;">
    <button onclick="goToPrevLevel()" style="padding: 10px 20px; font-size: 16px; cursor: pointer; margin: 5px;">←
      Previous</button>
    <button onclick="goToNextLevel()" style="padding: 10px 20px; font-size: 16px; cursor: pointer; margin: 5px;">Next
      →</button>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      if (window.Capacitor && window.Capacitor.Plugins && window.Capacitor.Plugins.App) {
        var App = window.Capacitor.Plugins.App;
        App.addListener('backButton', function(data) {
          if (data.canGoBack) {
            window.history.back();
          } else {
            App.exitApp();
          }
        });
      }
    });
  </script>
</body>

</html>